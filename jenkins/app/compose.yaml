---
name: jenkins

# TODO: traefik

networks:
  jenkins-net:
    name: jenkins-net

services:
  jenkins:
    container_name: jenkins
    build:
      context: .
    networks:
      - jenkins-net
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/bin/docker:/usr/bin/docker
      - /usr/libexec/docker:/usr/libexec/docker
      - /var/lib/jenkins:/var/jenkins_home
    restart: always
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.jenkins.rule=Host(`${JENKINS_HOST}`)"
      - "traefik.http.routers.jenkins.entrypoints=web"
      - "traefik.http.routers.jenkins.middlewares=redirect-https"
      - "traefik.http.routers.jenkins-secure.rule=Host(`${JENKINS_HOST}`)"
      - "traefik.http.routers.jenkins-secure.entrypoints=web-secure"
      - "traefik.http.routers.jenkins-secure.service=jenkins-secure"
      - "traefik.http.routers.jenkins-secure.tls=true"
      - "traefik.http.routers.jenkins-secure.tls.certresolver=letsencrypt"
      - "traefik.http.services.jenkins-secure.loadbalancer.server.port=8080"
      - "traefik.http.middlewares.redirect-https.redirectscheme.scheme=https"
      - "traefik.http.middlewares.redirect-https.redirectscheme.permanent=true"
      - "traefik.docker.network=jenkins-net"
